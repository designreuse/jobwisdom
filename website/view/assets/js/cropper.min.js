/*! zhifang-web 2016-03-24 */!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){"use strict";function b(a){return"number"==typeof a&&!isNaN(a)}function c(a){return"undefined"==typeof a}function d(a,c){var d=[];return b(c)&&d.push(c),d.slice.apply(a,d)}function e(a,b){var c=d(arguments,2);return function(){return a.apply(b,c.concat(d(arguments)))}}function f(a){var b=a.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return b&&(b[1]!==p.protocol||b[2]!==p.hostname||b[3]!==p.port)}function g(a){var b="timestamp="+(new Date).getTime();return a+(-1===a.indexOf("?")?"?":"&")+b}function h(a){return a?' crossOrigin="'+a+'"':""}function i(a,b){var c;return a.naturalWidth?b(a.naturalWidth,a.naturalHeight):(c=document.createElement("img"),c.onload=function(){b(this.width,this.height)},void(c.src=a.src))}function j(a){var c=[],d=a.rotate,e=a.scaleX,f=a.scaleY;return b(d)&&c.push("rotate("+d+"deg)"),b(e)&&b(f)&&c.push("scale("+e+","+f+")"),c.length?c.join(" "):"none"}function k(a,b){var c,d,e=ga(a.degree)%180,f=(e>90?180-e:e)*Math.PI/180,g=ha(f),h=ia(f),i=a.width,j=a.height,k=a.aspectRatio;return b?(c=i/(h+g/k),d=c/k):(c=i*h+j*g,d=i*g+j*h),{width:c,height:d}}function l(c,d){var e,f,g,h=a("<canvas>")[0],i=h.getContext("2d"),j=0,l=0,m=d.naturalWidth,n=d.naturalHeight,o=d.rotate,p=d.scaleX,q=d.scaleY,r=b(p)&&b(q)&&(1!==p||1!==q),s=b(o)&&0!==o,t=s||r,u=m,v=n;return r&&(e=m/2,f=n/2),s&&(g=k({width:m,height:n,degree:o}),u=g.width,v=g.height,e=g.width/2,f=g.height/2),h.width=u,h.height=v,t&&(j=-m/2,l=-n/2,i.save(),i.translate(e,f)),s&&i.rotate(o*Math.PI/180),r&&i.scale(p,q),i.drawImage(c,j,l,m,n),t&&i.restore(),h}function m(b,c){this.$element=a(b),this.options=a.extend({},m.DEFAULTS,a.isPlainObject(c)&&c),this.ready=!1,this.built=!1,this.complete=!1,this.rotated=!1,this.cropped=!1,this.disabled=!1,this.replaced=!1,this.isImg=!1,this.originalUrl="",this.crossOrigin="",this.canvas=null,this.cropBox=null,this.init()}var n=a(window),o=a(document),p=window.location,q="cropper",r="cropper-modal",s="cropper-hide",t="cropper-hidden",u="cropper-invisible",v="cropper-move",w="cropper-crop",x="cropper-disabled",y="cropper-bg",z="mousedown touchstart pointerdown MSPointerDown",A="mousemove touchmove pointermove MSPointerMove",B="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",C="wheel mousewheel DOMMouseScroll",D="dblclick",E="load."+q,F="error."+q,G="resize."+q,H="build."+q,I="built."+q,J="cropstart."+q,K="cropmove."+q,L="cropend."+q,M="crop."+q,N="zoom."+q,O=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,P="preview",Q="action",R="e",S="w",T="s",U="n",V="se",W="sw",X="ne",Y="nw",Z="all",$="crop",_="move",aa="zoom",ba="none",ca=a.isFunction(a("<canvas>")[0].getContext),da=Math.sqrt,ea=Math.min,fa=Math.max,ga=Math.abs,ha=Math.sin,ia=Math.cos,ja=parseFloat,ka={version:"1.0.0"};a.extend(ka,{init:function(){var a,b=this.$element;if(b.is("img")){if(this.isImg=!0,this.originalUrl=a=b.attr("src"),!a)return;a=b.prop("src")}else b.is("canvas")&&ca&&(a=b[0].toDataURL());this.load(a)},trigger:function(b,c){var d=a.Event(b,c);return this.$element.trigger(d),d},load:function(b){var c,d,e=this.options,i=this.$element,j="";b&&(this.url=b,i.one(H,e.build),this.trigger(H).isDefaultPrevented()||(e.checkImageOrigin&&f(b)&&(j=i.prop("crossOrigin"),j||(j="anonymous",c=g(b)),this.crossOrigin=j),this.$clone=d=a("<img"+h(j)+' src="'+(c||b)+'">'),this.isImg?i[0].complete?this.start():i.one(E,a.proxy(this.start,this)):d.one(E,a.proxy(this.start,this)).one(F,a.proxy(this.stop,this)).addClass(s).insertAfter(i)))},start:function(){var b=this.$element,c=this.$clone;this.isImg||(c.off(F,this.stop),b=c),i(b[0],a.proxy(function(a,b){this.image={naturalWidth:a,naturalHeight:b,aspectRatio:a/b},this.ready=!0,this.build()},this))},stop:function(){this.$clone.remove(),this.$clone=null}}),a.extend(ka,{build:function(){var b,c,d,e=this.options,f=this.$element,g=this.$clone;this.ready&&(this.built&&this.unbuild(),this.$container=f.parent(),this.$cropper=b=a(m.TEMPLATE),this.$canvas=b.find(".cropper-canvas").append(g),this.$dragBox=b.find(".cropper-drag-box"),this.$cropBox=c=b.find(".cropper-crop-box"),this.$viewBox=b.find(".cropper-view-box"),this.$face=d=c.find(".cropper-face"),f.addClass(t).after(b),this.isImg||g.removeClass(s),this.initPreview(),this.bind(),e.aspectRatio=ja(e.aspectRatio)||NaN,e.autoCrop?(this.cropped=!0,e.modal&&this.$dragBox.addClass(r)):c.addClass(t),e.guides||c.find(".cropper-dashed").addClass(t),e.center||c.find(".cropper-center").addClass(t),e.cropBoxMovable&&d.addClass(v).data(Q,Z),e.highlight||d.addClass(u),e.background&&b.addClass(y),e.cropBoxResizable||c.find(".cropper-line, .cropper-point").addClass(t),this.setDragMode(e.dragCrop?$:e.movable?_:ba),this.render(),this.built=!0,this.setData(e.data),f.one(I,e.built),setTimeout(a.proxy(function(){this.trigger(I),this.complete=!0},this),0))},unbuild:function(){this.built&&(this.built=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)}}),a.extend(ka,{render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var a=this.options,b=this.$element,c=this.$container,d=this.$cropper;d.addClass(t),b.removeClass(t),d.css(this.container={width:fa(c.width(),ja(a.minContainerWidth)||200),height:fa(c.height(),ja(a.minContainerHeight)||100)}),b.addClass(t),d.removeClass(t)},initCanvas:function(){var b=this.container,c=b.width,d=b.height,e=this.image,f=e.aspectRatio,g={aspectRatio:f,width:c,height:d};d*f>c?g.height=c/f:g.width=d*f,g.oldLeft=g.left=(c-g.width)/2,g.oldTop=g.top=(d-g.height)/2,this.canvas=g,this.limitCanvas(!0,!0),this.initialImage=a.extend({},e),this.initialCanvas=a.extend({},g)},limitCanvas:function(a,b){var c,d,e=this.options,f=e.strict,g=this.container,h=g.width,i=g.height,j=this.canvas,k=j.aspectRatio,l=this.cropBox,m=this.cropped&&l,n=this.initialCanvas||j;a&&(c=ja(e.minCanvasWidth)||0,d=ja(e.minCanvasHeight)||0,f&&(c?c=fa(c,m?l.width:n.width):d?d=fa(d,m?l.height:n.height):m&&(c=l.width,d=l.height,d*k>c?c=d*k:d=c/k)),c&&d?d*k>c?d=c/k:c=d*k:c?d=c/k:d&&(c=d*k),j.minWidth=c,j.minHeight=d,j.maxWidth=1/0,j.maxHeight=1/0),b&&(f?(j.minLeft=m?ea(l.left,l.left+l.width-j.width):ea(0,h-j.width),j.minTop=m?ea(l.top,l.top+l.height-j.height):ea(0,i-j.height),j.maxLeft=m?l.left:fa(0,h-j.width),j.maxTop=m?l.top:fa(0,i-j.height)):(j.minLeft=-j.width,j.minTop=-j.height,j.maxLeft=h,j.maxTop=i))},renderCanvas:function(a){var b,c,d=this.options,e=this.canvas,f=this.image;this.rotated&&(this.rotated=!1,c=k({width:f.width,height:f.height,degree:f.rotate}),b=c.width/c.height,b!==e.aspectRatio&&(e.left-=(c.width-e.width)/2,e.top-=(c.height-e.height)/2,e.width=c.width,e.height=c.height,e.aspectRatio=b,this.limitCanvas(!0,!1))),(e.width>e.maxWidth||e.width<e.minWidth)&&(e.left=e.oldLeft),(e.height>e.maxHeight||e.height<e.minHeight)&&(e.top=e.oldTop),e.width=ea(fa(e.width,e.minWidth),e.maxWidth),e.height=ea(fa(e.height,e.minHeight),e.maxHeight),this.limitCanvas(!1,!0),e.oldLeft=e.left=ea(fa(e.left,e.minLeft),e.maxLeft),e.oldTop=e.top=ea(fa(e.top,e.minTop),e.maxTop),this.$canvas.css({width:e.width,height:e.height,left:e.left,top:e.top}),this.renderImage(),this.cropped&&d.strict&&this.limitCropBox(!0,!0),a&&this.output()},renderImage:function(b){var c,d=this.canvas,e=this.image;e.rotate&&(c=k({width:d.width,height:d.height,degree:e.rotate,aspectRatio:e.aspectRatio},!0)),a.extend(e,c?{width:c.width,height:c.height,left:(d.width-c.width)/2,top:(d.height-c.height)/2}:{width:d.width,height:d.height,left:0,top:0}),this.$clone.css({width:e.width,height:e.height,marginLeft:e.left,marginTop:e.top,transform:j(e)}),b&&this.output()},initCropBox:function(){var b=this.options,c=this.canvas,d=b.aspectRatio,e=ja(b.autoCropArea)||.8,f={width:c.width,height:c.height};d&&(c.height*d>c.width?f.height=f.width/d:f.width=f.height*d),this.cropBox=f,this.limitCropBox(!0,!0),f.width=ea(fa(f.width,f.minWidth),f.maxWidth),f.height=ea(fa(f.height,f.minHeight),f.maxHeight),f.width=fa(f.minWidth,f.width*e),f.height=fa(f.minHeight,f.height*e),f.oldLeft=f.left=c.left+(c.width-f.width)/2,f.oldTop=f.top=c.top+(c.height-f.height)/2,this.initialCropBox=a.extend({},f)},limitCropBox:function(a,b){var c,d,e,f,g=this.options,h=g.strict,i=this.container,j=i.width,k=i.height,l=this.canvas,m=this.cropBox,n=g.aspectRatio;a&&(c=ja(g.minCropBoxWidth)||0,d=ja(g.minCropBoxHeight)||0,c=ea(c,j),d=ea(d,k),e=ea(j,h?l.width:j),f=ea(k,h?l.height:k),n&&(c&&d?d*n>c?d=c/n:c=d*n:c?d=c/n:d&&(c=d*n),f*n>e?f=e/n:e=f*n),m.minWidth=ea(c,e),m.minHeight=ea(d,f),m.maxWidth=e,m.maxHeight=f),b&&(h?(m.minLeft=fa(0,l.left),m.minTop=fa(0,l.top),m.maxLeft=ea(j,l.left+l.width)-m.width,m.maxTop=ea(k,l.top+l.height)-m.height):(m.minLeft=0,m.minTop=0,m.maxLeft=j-m.width,m.maxTop=k-m.height))},renderCropBox:function(){var a=this.options,b=this.container,c=b.width,d=b.height,e=this.cropBox;(e.width>e.maxWidth||e.width<e.minWidth)&&(e.left=e.oldLeft),(e.height>e.maxHeight||e.height<e.minHeight)&&(e.top=e.oldTop),e.width=ea(fa(e.width,e.minWidth),e.maxWidth),e.height=ea(fa(e.height,e.minHeight),e.maxHeight),this.limitCropBox(!1,!0),e.oldLeft=e.left=ea(fa(e.left,e.minLeft),e.maxLeft),e.oldTop=e.top=ea(fa(e.top,e.minTop),e.maxTop),a.movable&&a.cropBoxMovable&&this.$face.data(Q,e.width===c&&e.height===d?_:Z),this.$cropBox.css({width:e.width,height:e.height,left:e.left,top:e.top}),this.cropped&&a.strict&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),this.complete?this.trigger(M,this.getData()):this.built||this.$element.one(I,a.proxy(function(){this.trigger(M,this.getData())},this))}}),a.extend(ka,{initPreview:function(){var b=h(this.crossOrigin),c=this.url;this.$preview=a(this.options.preview),this.$viewBox.html("<img"+b+' src="'+c+'">'),this.$preview.each(function(){var d=a(this);d.data(P,{width:d.width(),height:d.height(),original:d.html()}),d.html("<img"+b+' src="'+c+'" style="display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important">')})},resetPreview:function(){this.$preview.each(function(){var b=a(this);b.html(b.data(P).original).removeData(P)})},preview:function(){var b=this.image,c=this.canvas,d=this.cropBox,e=d.width,f=d.height,g=b.width,h=b.height,i=d.left-c.left-b.left,k=d.top-c.top-b.top;this.cropped&&!this.disabled&&(this.$viewBox.find("img").css({width:g,height:h,marginLeft:-i,marginTop:-k,transform:j(b)}),this.$preview.each(function(){var c=a(this),d=c.data(P),l=d.width,m=d.height,n=l,o=m,p=1;e&&(p=l/e,o=f*p),f&&o>m&&(p=m/f,n=e*p,o=m),c.width(n).height(o).find("img").css({width:g*p,height:h*p,marginLeft:-i*p,marginTop:-k*p,transform:j(b)})}))}}),a.extend(ka,{bind:function(){var b=this.options,c=this.$element,d=this.$cropper;a.isFunction(b.cropstart)&&c.on(J,b.cropstart),a.isFunction(b.cropmove)&&c.on(K,b.cropmove),a.isFunction(b.cropend)&&c.on(L,b.cropend),a.isFunction(b.crop)&&c.on(M,b.crop),a.isFunction(b.zoom)&&c.on(N,b.zoom),d.on(z,a.proxy(this.cropStart,this)),b.zoomable&&b.mouseWheelZoom&&d.on(C,a.proxy(this.wheel,this)),b.doubleClickToggle&&d.on(D,a.proxy(this.dblclick,this)),o.on(A,this._cropMove=e(this.cropMove,this)).on(B,this._cropEnd=e(this.cropEnd,this)),b.responsive&&n.on(G,this._resize=e(this.resize,this))},unbind:function(){var b=this.options,c=this.$element,d=this.$cropper;a.isFunction(b.cropstart)&&c.off(J,b.cropstart),a.isFunction(b.cropmove)&&c.off(K,b.cropmove),a.isFunction(b.cropend)&&c.off(L,b.cropend),a.isFunction(b.crop)&&c.off(M,b.crop),a.isFunction(b.zoom)&&c.off(N,b.zoom),d.off(z,this.cropStart),b.zoomable&&b.mouseWheelZoom&&d.off(C,this.wheel),b.doubleClickToggle&&d.off(D,this.dblclick),o.off(A,this._cropMove).off(B,this._cropEnd),b.responsive&&n.off(G,this._resize)}}),a.extend(ka,{resize:function(){var b,c,d,e=this.$container,f=this.container;!this.disabled&&f&&(d=e.width()/f.width,(1!==d||e.height()!==f.height)&&(b=this.getCanvasData(),c=this.getCropBoxData(),this.render(),this.setCanvasData(a.each(b,function(a,c){b[a]=c*d})),this.setCropBoxData(a.each(c,function(a,b){c[a]=b*d}))))},dblclick:function(){this.disabled||(this.$dragBox.hasClass(w)?this.setDragMode(_):this.setDragMode($))},wheel:function(a){var b=a.originalEvent,c=b,d=ja(this.options.wheelZoomRatio)||.1,e=1;this.disabled||(a.preventDefault(),c.deltaY?e=c.deltaY>0?1:-1:c.wheelDelta?e=-c.wheelDelta/120:c.detail&&(e=c.detail>0?1:-1),this.zoom(-e*d,b))},cropStart:function(b){var c,d,e=this.options,f=b.originalEvent,g=f&&f.touches,h=b;if(!this.disabled){if(g){if(c=g.length,c>1){if(!e.zoomable||!e.touchDragZoom||2!==c)return;h=g[1],this.startX2=h.pageX,this.startY2=h.pageY,d=aa}h=g[0]}if(d=d||a(h.target).data(Q),O.test(d)){if(this.trigger(J,{originalEvent:f,action:d}).isDefaultPrevented())return;b.preventDefault(),this.action=d,this.cropping=!1,this.startX=h.pageX||f&&f.pageX,this.startY=h.pageY||f&&f.pageY,d===$&&(this.cropping=!0,this.$dragBox.addClass(r))}}},cropMove:function(a){var b,c=this.options,d=a.originalEvent,e=d&&d.touches,f=a,g=this.action;if(!this.disabled){if(e){if(b=e.length,b>1){if(!c.zoomable||!c.touchDragZoom||2!==b)return;f=e[1],this.endX2=f.pageX,this.endY2=f.pageY}f=e[0]}if(g){if(this.trigger(K,{originalEvent:d,action:g}).isDefaultPrevented())return;a.preventDefault(),this.endX=f.pageX||d&&d.pageX,this.endY=f.pageY||d&&d.pageY,this.change(f.shiftKey,g===aa?d:null)}}},cropEnd:function(a){var b=a.originalEvent,c=this.action;this.disabled||c&&(a.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(r,this.cropped&&this.options.modal)),this.action="",this.trigger(L,{originalEvent:b,action:c}))}}),a.extend(ka,{change:function(a,b){var c,d,e=this.options,f=e.aspectRatio,g=this.action,h=this.container,i=this.canvas,j=this.cropBox,k=j.width,l=j.height,m=j.left,n=j.top,o=m+k,p=n+l,q=0,r=0,s=h.width,u=h.height,v=!0;switch(!f&&a&&(f=k&&l?k/l:1),e.strict&&(q=j.minLeft,r=j.minTop,s=q+ea(h.width,i.width),u=r+ea(h.height,i.height)),d={x:this.endX-this.startX,y:this.endY-this.startY},f&&(d.X=d.y*f,d.Y=d.x/f),g){case Z:m+=d.x,n+=d.y;break;case R:if(d.x>=0&&(o>=s||f&&(r>=n||p>=u))){v=!1;break}k+=d.x,f&&(l=k/f,n-=d.Y/2),0>k&&(g=S,k=0);break;case U:if(d.y<=0&&(r>=n||f&&(q>=m||o>=s))){v=!1;break}l-=d.y,n+=d.y,f&&(k=l*f,m+=d.X/2),0>l&&(g=T,l=0);break;case S:if(d.x<=0&&(q>=m||f&&(r>=n||p>=u))){v=!1;break}k-=d.x,m+=d.x,f&&(l=k/f,n+=d.Y/2),0>k&&(g=R,k=0);break;case T:if(d.y>=0&&(p>=u||f&&(q>=m||o>=s))){v=!1;break}l+=d.y,f&&(k=l*f,m-=d.X/2),0>l&&(g=U,l=0);break;case X:if(f){if(d.y<=0&&(r>=n||o>=s)){v=!1;break}l-=d.y,n+=d.y,k=l*f}else d.x>=0?s>o?k+=d.x:d.y<=0&&r>=n&&(v=!1):k+=d.x,d.y<=0?n>r&&(l-=d.y,n+=d.y):(l-=d.y,n+=d.y);0>k&&0>l?(g=W,l=0,k=0):0>k?(g=Y,k=0):0>l&&(g=V,l=0);break;case Y:if(f){if(d.y<=0&&(r>=n||q>=m)){v=!1;break}l-=d.y,n+=d.y,k=l*f,m+=d.X}else d.x<=0?m>q?(k-=d.x,m+=d.x):d.y<=0&&r>=n&&(v=!1):(k-=d.x,m+=d.x),d.y<=0?n>r&&(l-=d.y,n+=d.y):(l-=d.y,n+=d.y);0>k&&0>l?(g=V,l=0,k=0):0>k?(g=X,k=0):0>l&&(g=W,l=0);break;case W:if(f){if(d.x<=0&&(q>=m||p>=u)){v=!1;break}k-=d.x,m+=d.x,l=k/f}else d.x<=0?m>q?(k-=d.x,m+=d.x):d.y>=0&&p>=u&&(v=!1):(k-=d.x,m+=d.x),d.y>=0?u>p&&(l+=d.y):l+=d.y;0>k&&0>l?(g=X,l=0,k=0):0>k?(g=V,k=0):0>l&&(g=Y,l=0);break;case V:if(f){if(d.x>=0&&(o>=s||p>=u)){v=!1;break}k+=d.x,l=k/f}else d.x>=0?s>o?k+=d.x:d.y>=0&&p>=u&&(v=!1):k+=d.x,d.y>=0?u>p&&(l+=d.y):l+=d.y;0>k&&0>l?(g=Y,l=0,k=0):0>k?(g=W,k=0):0>l&&(g=X,l=0);break;case _:this.move(d.x,d.y),v=!1;break;case aa:this.zoom(function(a,b,c,d){var e=da(a*a+b*b),f=da(c*c+d*d);return(f-e)/e}(ga(this.startX-this.startX2),ga(this.startY-this.startY2),ga(this.endX-this.endX2),ga(this.endY-this.endY2)),b),this.startX2=this.endX2,this.startY2=this.endY2,v=!1;break;case $:d.x&&d.y&&(c=this.$cropper.offset(),m=this.startX-c.left,n=this.startY-c.top,k=j.minWidth,l=j.minHeight,d.x>0?d.y>0?g=V:(g=X,n-=l):d.y>0?(g=W,m-=k):(g=Y,m-=k,n-=l),this.cropped||(this.cropped=!0,this.$cropBox.removeClass(t)))}v&&(j.width=k,j.height=l,j.left=m,j.top=n,this.action=g,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY}}),a.extend(ka,{crop:function(){this.built&&!this.disabled&&(this.cropped||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass(r),this.$cropBox.removeClass(t)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.built&&!this.disabled&&(this.image=a.extend({},this.initialImage),this.canvas=a.extend({},this.initialCanvas),this.cropBox=a.extend({},this.initialCropBox),this.renderCanvas(),this.cropped&&this.renderCropBox())},clear:function(){this.cropped&&!this.disabled&&(a.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass(r),this.$cropBox.addClass(t))},replace:function(a){!this.disabled&&a&&(this.isImg&&(this.replaced=!0,this.$element.attr("src",a)),this.options.data=null,this.load(a))},enable:function(){this.built&&(this.disabled=!1,this.$cropper.removeClass(x))},disable:function(){this.built&&(this.disabled=!0,this.$cropper.addClass(x))},destroy:function(){var a=this.$element;this.ready?(this.isImg&&this.replaced&&a.attr("src",this.originalUrl),this.unbuild(),a.removeClass(t)):this.isImg?a.off(E,this.start):this.$clone&&this.$clone.remove(),a.removeData(q)},move:function(a,d){var e=this.canvas;c(d)&&(d=a),a=ja(a),d=ja(d),this.built&&!this.disabled&&this.options.movable&&(e.left+=b(a)?a:0,e.top+=b(d)?d:0,this.renderCanvas(!0))},zoom:function(a,b){var c,d,e=this.canvas;if(a=ja(a),a&&this.built&&!this.disabled&&this.options.zoomable){if(this.trigger(N,{originalEvent:b,ratio:a}).isDefaultPrevented())return;a=0>a?1/(1-a):1+a,c=e.width*a,d=e.height*a,e.left-=(c-e.width)/2,e.top-=(d-e.height)/2,e.width=c,e.height=d,this.renderCanvas(!0),this.setDragMode(_)}},rotate:function(a){var b=this.image,c=b.rotate||0;a=ja(a)||0,this.built&&!this.disabled&&this.options.rotatable&&(b.rotate=(c+a)%360,this.rotated=!0,this.renderCanvas(!0))},scale:function(a,d){var e=this.image;c(d)&&(d=a),a=ja(a),d=ja(d),this.built&&!this.disabled&&this.options.scalable&&(e.scaleX=b(a)?a:1,e.scaleY=b(d)?d:1,this.renderImage(!0))},getData:function(b){var c,d,e=this.options,f=this.image,g=this.canvas,h=this.cropBox;return this.built&&this.cropped?(d={x:h.left-g.left,y:h.top-g.top,width:h.width,height:h.height},c=f.width/f.naturalWidth,a.each(d,function(a,e){e/=c,d[a]=b?Math.round(e):e})):d={x:0,y:0,width:0,height:0},e.rotatable&&(d.rotate=f.rotate||0),e.scalable&&(d.scaleX=f.scaleX||1,d.scaleY=f.scaleY||1),d},setData:function(c){var d,e,f,g=this.options,h=this.image,i=this.canvas,j={};a.isFunction(c)&&(c=c.call(this.element)),this.built&&!this.disabled&&a.isPlainObject(c)&&(g.rotatable&&b(c.rotate)&&c.rotate!==h.rotate&&(h.rotate=c.rotate,this.rotated=d=!0),g.scalable&&(b(c.scaleX)&&c.scaleX!==h.scaleX&&(h.scaleX=c.scaleX,e=!0),b(c.scaleY)&&c.scaleY!==h.scaleY&&(h.scaleY=c.scaleY,e=!0)),d?this.renderCanvas():e&&this.renderImage(),f=h.width/h.naturalWidth,b(c.x)&&(j.left=c.x*f+i.left),b(c.y)&&(j.top=c.y*f+i.top),b(c.width)&&(j.width=c.width*f),b(c.height)&&(j.height=c.height*f),this.setCropBoxData(j))},getContainerData:function(){return this.built?this.container:{}},getImageData:function(){return this.ready?this.image:{}},getCanvasData:function(){var a,b=this.canvas;return this.built&&(a={left:b.left,top:b.top,width:b.width,height:b.height}),a||{}},setCanvasData:function(c){var d=this.canvas,e=d.aspectRatio;a.isFunction(c)&&(c=c.call(this.$element)),this.built&&!this.disabled&&a.isPlainObject(c)&&(b(c.left)&&(d.left=c.left),b(c.top)&&(d.top=c.top),b(c.width)?(d.width=c.width,d.height=c.width/e):b(c.height)&&(d.height=c.height,d.width=c.height*e),this.renderCanvas(!0))},getCropBoxData:function(){var a,b=this.cropBox;return this.built&&this.cropped&&(a={left:b.left,top:b.top,width:b.width,height:b.height}),a||{}},setCropBoxData:function(c){var d,e,f=this.cropBox,g=this.options.aspectRatio;a.isFunction(c)&&(c=c.call(this.$element)),this.built&&this.cropped&&!this.disabled&&a.isPlainObject(c)&&(b(c.left)&&(f.left=c.left),b(c.top)&&(f.top=c.top),b(c.width)&&c.width!==f.width&&(d=!0,f.width=c.width),b(c.height)&&c.height!==f.height&&(e=!0,f.height=c.height),g&&(d?f.height=f.width/g:e&&(f.width=f.height*g)),this.renderCropBox())},getCroppedCanvas:function(b){var c,d,e,f,g,h,i,j,k,m,n;return this.built&&this.cropped&&ca?(a.isPlainObject(b)||(b={}),n=this.getData(),c=n.width,d=n.height,j=c/d,a.isPlainObject(b)&&(g=b.width,h=b.height,g?(h=g/j,i=g/c):h&&(g=h*j,i=h/d)),e=g||c,f=h||d,k=a("<canvas>")[0],k.width=e,k.height=f,m=k.getContext("2d"),b.fillColor&&(m.fillStyle=b.fillColor,m.fillRect(0,0,e,f)),m.drawImage.apply(m,function(){var a,b,e,f,g,h,j=l(this.$clone[0],this.image),k=j.width,m=j.height,o=[j],p=n.x,q=n.y;return-c>=p||p>k?p=a=e=g=0:0>=p?(e=-p,p=0,a=g=ea(k,c+p)):k>=p&&(e=0,a=g=ea(c,k-p)),0>=a||-d>=q||q>m?q=b=f=h=0:0>=q?(f=-q,q=0,b=h=ea(m,d+q)):m>=q&&(f=0,b=h=ea(d,m-q)),o.push(p,q,a,b),i&&(e*=i,f*=i,g*=i,h*=i),g>0&&h>0&&o.push(e,f,g,h),o}.call(this)),k):void 0},setAspectRatio:function(a){var b=this.options;this.disabled||c(a)||(b.aspectRatio=ja(a)||NaN,this.built&&(this.initCropBox(),this.cropped&&this.renderCropBox()))},setDragMode:function(a){var b,c,d=this.options;this.ready&&!this.disabled&&(b=d.dragCrop&&a===$,c=d.movable&&a===_,a=b||c?a:ba,this.$dragBox.data(Q,a).toggleClass(w,b).toggleClass(v,c),d.cropBoxMovable||this.$face.data(Q,a).toggleClass(w,b).toggleClass(v,c))}}),a.extend(m.prototype,ka),m.DEFAULTS={aspectRatio:NaN,data:null,preview:"",strict:!0,responsive:!0,checkImageOrigin:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,dragCrop:!0,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,mouseWheelZoom:!0,wheelZoomRatio:.1,touchDragZoom:!0,cropBoxMovable:!0,cropBoxResizable:!0,doubleClickToggle:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},m.setDefaults=function(b){a.extend(m.DEFAULTS,b)},m.TEMPLATE='<div class="cropper-container"><div class="cropper-canvas"></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',m.other=a.fn.cropper,a.fn.cropper=function(b){var e,f=d(arguments,1);return this.each(function(){var c,d=a(this),g=d.data(q);if(!g){if(/destroy/.test(b))return;d.data(q,g=new m(this,b))}"string"==typeof b&&a.isFunction(c=g[b])&&(e=c.apply(g,f))}),c(e)?this:e},a.fn.cropper.Constructor=m,a.fn.cropper.setDefaults=m.setDefaults,a.fn.cropper.noConflict=function(){return a.fn.cropper=m.other,this}});